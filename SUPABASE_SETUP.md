# Supabase Setup Guide

To enable persistent data storage for your application (instead of using the temporary filesystem), we will use **Supabase**.

### 1. Create a Supabase Project
1.  Go to [Supabase](https://supabase.com/) and sign up/log in.
2.  Click **"New Project"**.
3.  Name it `customer-segmentation-db` and set a password.
4.  Wait for the database to provision.

### 2. Create the Table
Since our app processes dynamic CSV files with varying columns, we will store each row as a generic **JSON object**. This is flexible and prevents errors if you upload files with different columns.

1.  In your Supabase Dashboard, go to the **SQL Editor** (icon on the left).
2.  Click **"New Query"**.
3.  Paste the following SQL commands:

```sql
-- Create a table to store dynamic customer data
create table customers (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  data jsonb not null
);

-- Enable Row Level Security (RLS) recommended, but for this demo API we can allow access
-- For simplicity in this demo, let's allow public access (or handle it via service key)
alter table customers enable row level security;

-- Allow full access to authenticated users (and service role)
create policy "Enable all for all" on customers
for all using (true) with check (true);
```
4.  Click **"Run"**.

### 3. Get API Credentials
1.  Go to **Project Settings** (gear icon) -> **API**.
2.  Copy the **Project URL** (`SUPABASE_URL`).
3.  Copy the **`service_role` secret** (or `anon` public key if you adjusted RLS properly, but `service_role` ensures your backend can bypass RLS for simple functionality).
    *   *Note*: For a backend server, using the `service_role` key is often easiest to bypass RLS, but be careful not to expose it to the frontend. Since we are deploying a secured backend, it's okay store it as an ENV variable there.

### 4. Configure Vercel (Backend)
1.  Go to your **Vercel Dashboard**.
2.  Select the `customer-segmentation-backend` project.
3.  Go to **Settings** -> **Environment Variables**.
4.  Add the following:
    -   `SUPABASE_URL`: (Paste your URL)
    -   `SUPABASE_KEY`: (Paste your Key)
5.  **Redeploy** your backend for the changes to take effect (go to Deployments -> Redeploy).

Your app will now automatically detect these variables and switch from SQLite to Supabase!
